---
- name: Initial setup
  hosts: all
  gather_facts: false
  remote_user: gnus
  become: true
  vars:
  vars_files:
    - ../vars/ssh_keys.yml
  tasks:
    - name: "Add user slayed"
      ansible.builtin.user:
        name: slayed
        shell: /bin/bash
    - name: "Add slayed user to the sudoers"
      ansible.builtin.copy:
        dest: "/etc/sudoers.d/slayed"
        content: "slayed  ALL=(ALL)  NOPASSWD: ALL"
        owner: root
        group: root
        mode: 0440
    - name: "Update apt-get repo and cache"
      ansible.builtin.apt:
        update_cache: true
        force_apt_get: true
        cache_valid_time: 3600
    - name: "Upgrade all apt packages"
      ansible.builtin.apt:
        upgrade: "dist"
        force_apt_get: true
